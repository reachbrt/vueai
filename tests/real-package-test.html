<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Package Test - Predictive Input</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 28px; margin-bottom: 8px; }
    .header p { opacity: 0.9; font-size: 14px; }
    .content { padding: 30px; }
    .test-result {
      background: #f8fafc;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid #667eea;
    }
    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .test-input {
      font-size: 16px;
      font-weight: 600;
      color: #667eea;
    }
    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .badge.pass { background: #dcfce7; color: #166534; }
    .badge.fail { background: #fee2e2; color: #991b1b; }
    .predictions {
      background: white;
      border-radius: 6px;
      padding: 12px;
      margin-top: 10px;
    }
    .pred-item {
      padding: 10px;
      margin: 6px 0;
      background: #f1f5f9;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .summary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      margin-top: 25px;
    }
    .summary.fail { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .summary h2 { font-size: 24px; margin-bottom: 12px; }
    .summary .stats { font-size: 42px; font-weight: 700; margin: 15px 0; }
    .loading {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }
    .spinner {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #dc2626;
    }
    .manual-test {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      margin: 10px 0;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß™ Real Package Test</h1>
      <p>Testing the actual built @aivue/predictive-input package</p>
    </div>
    
    <div class="content">
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading package and running tests...</p>
      </div>
      
      <div id="error" style="display: none;"></div>
      
      <div id="results" style="display: none;">
        <h2 style="margin-bottom: 15px;">üìä Test Results</h2>
        <div id="test-results"></div>
        
        <div class="manual-test">
          <h3 style="margin-bottom: 10px;">‚úçÔ∏è Manual Test</h3>
          <p style="color: #64748b; font-size: 14px; margin-bottom: 10px;">
            Type to see real-time predictions from the package:
          </p>
          <input type="text" id="manual-input" placeholder="Try: 'I am', 'thank', 'how are', 'please'...">
          <div id="manual-predictions"></div>
        </div>

        <div id="summary"></div>
      </div>
    </div>
  </div>

  <script type="module">
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    const testResultsDiv = document.getElementById('test-results');
    const summaryDiv = document.getElementById('summary');
    const manualInput = document.getElementById('manual-input');
    const manualPredictions = document.getElementById('manual-predictions');

    try {
      console.log('üì¶ Importing package from: ../packages/predictive-input/dist/index.mjs');
      
      // Import from built package
      const module = await import('../packages/predictive-input/dist/index.mjs');
      console.log('‚úÖ Package imported:', module);
      
      const { usePredictiveInput } = module;
      
      if (!usePredictiveInput) {
        throw new Error('usePredictiveInput not found in package exports');
      }
      
      console.log('‚úÖ usePredictiveInput found');
      
      // Initialize composable
      const composable = usePredictiveInput({
        storageKey: 'real_package_test',
        enableOffline: false
      });
      
      console.log('‚úÖ Composable initialized:', composable);
      
      const { updatePredictions, isTrained } = composable;
      
      console.log('‚úÖ isTrained:', isTrained.value);
      console.log('üß™ Starting tests WITHOUT training...');

      // Test cases
      const testCases = [
        { input: 'I am', desc: 'Common phrase' },
        { input: 'thank', desc: 'Gratitude' },
        { input: 'how are', desc: 'Question' },
        { input: 'please', desc: 'Request' },
        { input: 'I would like', desc: 'Formal' },
        { input: 'looking forward', desc: 'Closing' },
        { input: 'what is', desc: 'Question' },
        { input: 'can you', desc: 'Request' }
      ];

      let passed = 0;
      const total = testCases.length;

      testCases.forEach((test, index) => {
        console.log(`\nTest ${index + 1}: "${test.input}"`);
        
        const predictions = updatePredictions('', test.input, test.input.length);
        console.log(`  Predictions:`, predictions);
        
        const hasPredictions = predictions && predictions.length > 0;
        if (hasPredictions) passed++;
        
        const testDiv = document.createElement('div');
        testDiv.className = 'test-result';
        
        let html = `
          <div class="test-header">
            <span class="test-input">${index + 1}. "${test.input}"</span>
            <span class="badge ${hasPredictions ? 'pass' : 'fail'}">${hasPredictions ? '‚úÖ PASS' : '‚ùå FAIL'}</span>
          </div>
          <div style="color: #64748b; font-size: 13px; margin-bottom: 10px;">${test.desc}</div>
        `;
        
        if (hasPredictions) {
          html += '<div class="predictions">';
          html += `<div style="color: #64748b; font-size: 12px; margin-bottom: 8px; font-weight: 600;">Found ${predictions.length} prediction(s):</div>`;
          predictions.slice(0, 5).forEach((pred, i) => {
            const fullText = `${test.input} ${pred.text}`;
            html += `
              <div class="pred-item">
                <span style="font-weight: 500;">${i + 1}. "${fullText}"</span>
                <span style="background: #667eea; color: white; padding: 3px 8px; border-radius: 10px; font-size: 10px; font-weight: 600;">${(pred.confidence * 100).toFixed(1)}%</span>
              </div>
            `;
          });
          html += '</div>';
        } else {
          html += '<div style="color: #991b1b; margin-top: 8px; font-weight: 500;">‚ùå No predictions</div>';
        }
        
        testDiv.innerHTML = html;
        testResultsDiv.appendChild(testDiv);
      });

      // Summary
      const percentage = ((passed / total) * 100).toFixed(1);
      const summaryClass = passed === total ? 'summary' : 'summary fail';
      const summaryIcon = passed === total ? 'üéâ' : '‚ö†Ô∏è';
      const summaryText = passed === total ? 'All tests passed!' : `${passed} of ${total} tests passed`;
      
      summaryDiv.className = summaryClass;
      summaryDiv.innerHTML = `
        <h2>${summaryIcon} Test Summary</h2>
        <div class="stats">${passed} / ${total}</div>
        <div style="font-size: 18px; margin-bottom: 8px;">${percentage}% Pass Rate</div>
        <div style="font-size: 14px; opacity: 0.9;">${summaryText}</div>
      `;

      // Manual test
      manualInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (value.length < 2) {
          manualPredictions.innerHTML = '';
          return;
        }

        const predictions = updatePredictions('', value, value.length);
        
        if (predictions && predictions.length > 0) {
          let html = '<div class="predictions" style="margin-top: 12px;">';
          html += '<div style="color: #64748b; font-size: 12px; margin-bottom: 8px; font-weight: 600;">Predictions:</div>';
          predictions.slice(0, 5).forEach((pred, i) => {
            const fullText = `${value} ${pred.text}`;
            html += `
              <div class="pred-item">
                <span style="font-weight: 500;">${i + 1}. "${fullText}"</span>
                <span style="background: #667eea; color: white; padding: 3px 8px; border-radius: 10px; font-size: 10px; font-weight: 600;">${(pred.confidence * 100).toFixed(1)}%</span>
              </div>
            `;
          });
          html += '</div>';
          manualPredictions.innerHTML = html;
        } else {
          manualPredictions.innerHTML = '<div style="color: #64748b; margin-top: 10px;">No predictions</div>';
        }
      });

      loadingDiv.style.display = 'none';
      resultsDiv.style.display = 'block';
      
      console.log(`\n‚úÖ Tests complete: ${passed}/${total} passed (${percentage}%)`);
      
    } catch (error) {
      console.error('‚ùå Error:', error);
      loadingDiv.style.display = 'none';
      errorDiv.style.display = 'block';
      errorDiv.className = 'error';
      errorDiv.innerHTML = `
        <h3 style="margin-bottom: 10px;">‚ùå Test Failed</h3>
        <p><strong>Error:</strong> ${error.message}</p>
        <p style="margin-top: 10px; font-size: 13px;"><strong>Stack:</strong></p>
        <pre style="font-size: 11px; overflow-x: auto; margin-top: 5px;">${error.stack}</pre>
      `;
    }
  </script>
</body>
</html>

