<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Method 1: Browser-Based Visual Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 32px; margin-bottom: 10px; }
    .header p { opacity: 0.9; font-size: 16px; }
    .content { padding: 30px; }
    .test-section {
      background: #f8fafc;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border: 2px solid #e2e8f0;
    }
    .test-section h2 {
      color: #1e293b;
      margin-bottom: 15px;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .test-case {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .test-input {
      font-size: 18px;
      font-weight: 600;
      color: #667eea;
    }
    .badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge.pass { background: #dcfce7; color: #166534; }
    .badge.fail { background: #fee2e2; color: #991b1b; }
    .test-desc { color: #64748b; font-size: 14px; margin-bottom: 12px; }
    .predictions {
      background: #f1f5f9;
      border-radius: 6px;
      padding: 15px;
      margin-top: 12px;
    }
    .prediction-item {
      background: white;
      padding: 12px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }
    .prediction-item:hover {
      border-color: #667eea;
      transform: translateX(5px);
    }
    .prediction-text {
      font-weight: 500;
      color: #1e293b;
    }
    .confidence {
      background: #667eea;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }
    .summary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      margin-top: 30px;
    }
    .summary.partial { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .summary.fail { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .summary h2 { font-size: 28px; margin-bottom: 15px; }
    .summary .stats { font-size: 48px; font-weight: 700; margin: 20px 0; }
    .manual-test {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
    }
    .manual-test h3 { margin-bottom: 15px; font-size: 20px; }
    input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 0;
      transition: all 0.2s;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }
    .spinner {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #dc2626;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß™ Method 1: Browser-Based Visual Test</h1>
      <p>Testing @aivue/predictive-input package with full sentence predictions</p>
    </div>
    
    <div class="content">
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading package and running tests...</p>
      </div>
      
      <div id="error" style="display: none;"></div>
      
      <div id="results" style="display: none;">
        <div class="test-section">
          <h2>üìä Automated Test Results</h2>
          <div id="test-results"></div>
        </div>

        <div class="test-section">
          <div class="manual-test">
            <h3>‚úçÔ∏è Manual Interactive Test</h3>
            <p style="opacity: 0.9; margin-bottom: 15px;">Type a few words to see real-time predictions:</p>
            <input type="text" id="manual-input" placeholder="Try: 'I am', 'thank', 'how are', 'please'...">
            <div id="manual-predictions"></div>
          </div>
        </div>

        <div id="summary"></div>
      </div>
    </div>
  </div>

  <script type="module">
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    const testResultsDiv = document.getElementById('test-results');
    const summaryDiv = document.getElementById('summary');
    const manualInput = document.getElementById('manual-input');
    const manualPredictions = document.getElementById('manual-predictions');

    try {
      // Import from built package
      const { usePredictiveInput } = await import('../packages/predictive-input/dist/index.mjs');
      
      console.log('‚úÖ Package imported successfully');
      
      // Initialize composable
      const { updatePredictions, train, isTrained } = usePredictiveInput({
        storageKey: 'browser_test_predictive',
        enableOffline: false
      });

      console.log('‚úÖ Composable initialized');

      // Test cases
      const testCases = [
        { input: 'I am', desc: 'Common phrase start', expected: ['writing', 'looking', 'interested'] },
        { input: 'thank', desc: 'Gratitude expression', expected: ['you'] },
        { input: 'how are', desc: 'Question starter', expected: ['you'] },
        { input: 'please', desc: 'Polite request', expected: ['let', 'send', 'provide'] },
        { input: 'I would like', desc: 'Formal request', expected: ['to'] },
        { input: 'looking forward', desc: 'Email closing', expected: ['to'] },
        { input: 'what is', desc: 'Question', expected: ['the', 'your'] },
        { input: 'can you', desc: 'Request', expected: ['help', 'please'] }
      ];

      let passed = 0;
      const total = testCases.length;

      console.log(`üß™ Running ${total} tests...`);

      // Run tests
      testCases.forEach((test, index) => {
        const predictions = updatePredictions('', test.input, test.input.length);
        
        const hasPredictions = predictions.length > 0;
        if (hasPredictions) passed++;
        
        const testDiv = document.createElement('div');
        testDiv.className = 'test-case';
        
        let html = `
          <div class="test-header">
            <span class="test-input">${index + 1}. "${test.input}"</span>
            <span class="badge ${hasPredictions ? 'pass' : 'fail'}">${hasPredictions ? '‚úÖ PASS' : '‚ùå FAIL'}</span>
          </div>
          <div class="test-desc">${test.desc}</div>
        `;
        
        if (predictions.length > 0) {
          html += '<div class="predictions">';
          html += `<div style="color: #64748b; font-size: 13px; margin-bottom: 10px; font-weight: 600;">Found ${predictions.length} prediction(s):</div>`;
          predictions.slice(0, 5).forEach((pred, i) => {
            const fullText = `${test.input} ${pred.text}`;
            html += `
              <div class="prediction-item">
                <span class="prediction-text">${i + 1}. "${fullText}"</span>
                <span class="confidence">${(pred.confidence * 100).toFixed(1)}%</span>
              </div>
            `;
          });
          html += '</div>';
        } else {
          html += '<div style="color: #991b1b; margin-top: 10px; font-weight: 500;">‚ùå No predictions generated</div>';
        }
        
        testDiv.innerHTML = html;
        testResultsDiv.appendChild(testDiv);
      });

      // Show summary
      const percentage = ((passed / total) * 100).toFixed(1);
      let summaryClass = 'summary';
      let summaryIcon = 'üéâ';
      let summaryText = 'All tests passed!';
      
      if (passed === total) {
        summaryClass = 'summary';
        summaryIcon = 'üéâ';
        summaryText = 'Perfect! All tests passed! Full sentence predictions working!';
      } else if (passed >= total * 0.75) {
        summaryClass = 'summary partial';
        summaryIcon = '‚úÖ';
        summaryText = 'Most tests passed! Predictions are working well.';
      } else {
        summaryClass = 'summary fail';
        summaryIcon = '‚ö†Ô∏è';
        summaryText = 'Some tests failed. Review needed.';
      }
      
      summaryDiv.className = summaryClass;
      summaryDiv.innerHTML = `
        <h2>${summaryIcon} Test Summary</h2>
        <div class="stats">${passed} / ${total}</div>
        <div style="font-size: 20px; margin-bottom: 10px;">${percentage}% Pass Rate</div>
        <div style="font-size: 16px; opacity: 0.9;">${summaryText}</div>
      `;

      // Manual test
      manualInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (value.length < 2) {
          manualPredictions.innerHTML = '';
          return;
        }

        const predictions = updatePredictions('', value, value.length);
        
        if (predictions.length > 0) {
          let html = '<div style="margin-top: 15px;">';
          html += '<div style="color: white; font-size: 14px; margin-bottom: 10px; opacity: 0.9;">Predictions:</div>';
          predictions.slice(0, 5).forEach((pred, i) => {
            const fullText = `${value} ${pred.text}`;
            html += `
              <div style="background: rgba(255,255,255,0.2); padding: 10px; margin: 6px 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                <span style="color: white; font-weight: 500;">${i + 1}. "${fullText}"</span>
                <span style="background: rgba(255,255,255,0.3); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">${(pred.confidence * 100).toFixed(1)}%</span>
              </div>
            `;
          });
          html += '</div>';
          manualPredictions.innerHTML = html;
        } else {
          manualPredictions.innerHTML = '<div style="color: rgba(255,255,255,0.7); margin-top: 10px;">No predictions available</div>';
        }
      });

      // Hide loading, show results
      loadingDiv.style.display = 'none';
      resultsDiv.style.display = 'block';
      
      console.log(`‚úÖ Tests complete: ${passed}/${total} passed (${percentage}%)`);
      
    } catch (error) {
      console.error('‚ùå Error:', error);
      loadingDiv.style.display = 'none';
      errorDiv.style.display = 'block';
      errorDiv.className = 'error';
      errorDiv.innerHTML = `
        <h3 style="margin-bottom: 10px;">‚ùå Test Failed</h3>
        <p><strong>Error:</strong> ${error.message}</p>
        <p style="margin-top: 10px; font-size: 13px;">Check the browser console for more details.</p>
      `;
    }
  </script>
</body>
</html>

