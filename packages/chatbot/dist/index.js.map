{"version":3,"file":"index.js","sources":["../src/composables/useChatEngine.ts","../src/utils/markdown.ts","../src/components/AiChatWindow.vue","../src/components/AiChatToggle.vue","../src/index.ts"],"sourcesContent":["import { ref, reactive, toRefs, watch, onMounted, Ref } from 'vue';\nimport { v4 as uuidv4 } from 'uuid';\nimport { AIClient, Message as CoreMessage, StreamCallbacks, AIProvider } from '@aivue/core';\n\n// Define types\nexport interface Message extends CoreMessage {\n  id?: string;\n  timestamp?: Date;\n}\n\nexport interface ChatOptions {\n  // Required options\n  provider: AIProvider;\n  apiKey?: string;\n  model?: string;\n\n  // Optional client configuration\n  client?: AIClient;\n  baseUrl?: string;\n  organizationId?: string;\n\n  // Chat behavior options\n  initialMessages?: Message[];\n  systemPrompt?: string;\n  streaming?: boolean;\n  persistenceKey?: string | null;\n  maxMessages?: number;\n\n  // Demo mode\n  demoMode?: boolean;\n  demoResponses?: Record<string, string>;\n\n  // Proxy options for security\n  useProxy?: boolean;\n  proxyUrl?: string;\n\n  // Callbacks\n  onError?: ((error: Error) => void) | null;\n  onMessageSent?: ((message: Message) => void) | null;\n  onResponseReceived?: ((message: Message) => void) | null;\n}\n\nexport interface ChatState {\n  messages: Message[];\n  isLoading: boolean;\n  error: Error | null;\n}\n\nexport interface ChatEngineReturn {\n  // Reactive refs\n  messages: Ref<Message[]>;\n  isLoading: Ref<boolean>;\n  error: Ref<Error | null>;\n\n  // Methods\n  sendMessage: (content: string) => Promise<void>;\n  clearMessages: () => void;\n  setMessages: (messages: Message[]) => void;\n  addMessage: (message: Message) => void;\n  resetError: () => void;\n  updateConfig: (config: Partial<ChatOptions>) => void;\n}\n\n/**\n * Composable for managing chat state and interactions with AI\n *\n * @param options - Configuration options\n * @returns Chat state and methods\n */\nexport function useChatEngine(options: ChatOptions): ChatEngineReturn {\n  // Create or use provided client\n  let client: AIClient;\n\n  if (options.client) {\n    client = options.client;\n  } else if (options.provider) {\n    // Create a new client if one wasn't provided\n    client = new AIClient({\n      provider: options.provider,\n      apiKey: options.apiKey,\n      model: options.model || getDefaultModelForProvider(options.provider),\n      baseUrl: options.baseUrl,\n      organizationId: options.organizationId\n    });\n  } else {\n    throw new Error('Either client or provider must be specified in options');\n  }\n\n  // Extract other options with defaults\n  const {\n    initialMessages = [],\n    systemPrompt = 'You are a helpful assistant.',\n    streaming = true,\n    persistenceKey = null,\n    maxMessages = 100,\n    demoMode = false,\n    demoResponses = {},\n    useProxy = false,\n    proxyUrl = '/api/chat',\n    onError = null,\n    onMessageSent = null,\n    onResponseReceived = null\n  } = options;\n\n  // Create reactive state using refs for better Vue 3 compatibility\n  const messages = ref<Message[]>([]);\n  const isLoading = ref<boolean>(false);\n  const error = ref<Error | null>(null);\n\n  // Initialize messages with timestamps and IDs\n  const initializeMessages = (msgs: Message[]): Message[] => {\n    return msgs.map(msg => ({\n      ...msg,\n      id: msg.id || uuidv4(),\n      timestamp: msg.timestamp || new Date()\n    }));\n  };\n\n  // Load messages from localStorage if persistenceKey is provided\n  onMounted(() => {\n    if (persistenceKey) {\n      try {\n        const savedMessages = localStorage.getItem(persistenceKey);\n        if (savedMessages) {\n          messages.value = initializeMessages(JSON.parse(savedMessages));\n          return;\n        }\n      } catch (err) {\n        console.error('Error loading chat history:', err);\n      }\n    }\n\n    // If no saved messages or error loading, use initialMessages\n    messages.value = initializeMessages(initialMessages);\n  });\n\n  // Save messages to localStorage when they change\n  const saveMessagesToLocalStorage = () => {\n    if (persistenceKey) {\n      try {\n        localStorage.setItem(persistenceKey, JSON.stringify(messages.value));\n      } catch (err) {\n        console.error('Error saving chat history:', err);\n      }\n    }\n  };\n\n  // Watch for changes to save to localStorage\n  watch(messages, () => {\n    saveMessagesToLocalStorage();\n  }, { deep: true });\n\n  /**\n   * Reset error state\n   */\n  const resetError = (): void => {\n    error.value = null;\n  };\n\n  /**\n   * Update configuration options\n   *\n   * @param config - New configuration options\n   */\n  const updateConfig = (config: Partial<ChatOptions>): void => {\n    // Update client configuration if needed\n    if (config.provider || config.apiKey || config.model || config.baseUrl || config.organizationId) {\n      client = new AIClient({\n        provider: config.provider || options.provider,\n        apiKey: config.apiKey || options.apiKey,\n        model: config.model || options.model || getDefaultModelForProvider(config.provider || options.provider),\n        baseUrl: config.baseUrl || options.baseUrl,\n        organizationId: config.organizationId || options.organizationId\n      });\n    }\n\n    // Update other options\n    Object.assign(options, config);\n  };\n\n  /**\n   * Send a user message and get AI response\n   *\n   * @param content - Message content\n   * @returns Promise that resolves when the message is sent and response is received\n   */\n  const sendMessage = async (content: string): Promise<void> => {\n    if (!content.trim()) return;\n\n    // Reset error state\n    error.value = null;\n\n    // Add user message\n    const userMessage: Message = {\n      role: 'user',\n      content,\n      id: uuidv4(),\n      timestamp: new Date()\n    };\n    messages.value.push(userMessage);\n\n    // Call onMessageSent callback if provided\n    if (onMessageSent) {\n      onMessageSent(userMessage);\n    }\n\n    // Start loading\n    isLoading.value = true;\n\n    try {\n      // Prepare messages for the AI\n      const messagesToSend: CoreMessage[] = [\n        { role: 'system', content: systemPrompt },\n        ...messages.value.filter(msg => msg.role === 'user' || msg.role === 'assistant')\n          .map(({ role, content }) => ({ role, content }))\n      ];\n\n      // Check if we're in demo mode\n      if (demoMode) {\n        // Generate a demo response\n        let demoResponse = \"I'm a demo AI assistant. This is a simulated response.\";\n\n        // Check if we have a matching demo response\n        const userMessageLower = userMessage.content.toLowerCase();\n        for (const [key, response] of Object.entries(demoResponses)) {\n          if (userMessageLower.includes(key.toLowerCase())) {\n            demoResponse = response;\n            break;\n          }\n        }\n\n        if (streaming) {\n          // Simulate streaming for demo mode\n          const assistantMessage: Message = {\n            role: 'assistant',\n            content: '',\n            id: uuidv4(),\n            timestamp: new Date()\n          };\n          messages.value.push(assistantMessage);\n\n          let streamedContent = '';\n          const streamResponse = async () => {\n            for (const char of demoResponse) {\n              await new Promise(resolve => setTimeout(resolve, 20));\n              streamedContent += char;\n              assistantMessage.content = streamedContent;\n            }\n            isLoading.value = false;\n            if (onResponseReceived) {\n              onResponseReceived(assistantMessage);\n            }\n            if (persistenceKey) {\n              saveMessagesToLocalStorage();\n            }\n          };\n\n          streamResponse();\n          return;\n        } else {\n          // Non-streaming demo mode\n          const assistantMessage: Message = {\n            role: 'assistant',\n            content: demoResponse,\n            id: uuidv4(),\n            timestamp: new Date()\n          };\n          messages.value.push(assistantMessage);\n          isLoading.value = false;\n          if (onResponseReceived) {\n            onResponseReceived(assistantMessage);\n          }\n          if (persistenceKey) {\n            saveMessagesToLocalStorage();\n          }\n          return;\n        }\n      }\n\n      if (streaming) {\n        // For streaming responses\n        let responseContent = '';\n\n        // Add placeholder for assistant message\n        const assistantMessage: Message = {\n          role: 'assistant',\n          content: '',\n          id: uuidv4(),\n          timestamp: new Date()\n        };\n        messages.value.push(assistantMessage);\n\n        const callbacks: StreamCallbacks = {\n          onStart: () => {\n            // Message already added above\n            console.log('Stream started');\n          },\n          onToken: (token: string) => {\n            // Update the last message with the new token\n            responseContent += token;\n            const lastMessage = messages.value[messages.value.length - 1];\n            if (lastMessage && lastMessage.role === 'assistant') {\n              lastMessage.content = responseContent;\n            }\n          },\n          onComplete: (completeText: string) => {\n            isLoading.value = false;\n            console.log('Stream completed');\n\n            // Call onResponseReceived callback if provided\n            if (onResponseReceived) {\n              const lastMessage = messages.value[messages.value.length - 1];\n              if (lastMessage && lastMessage.role === 'assistant') {\n                onResponseReceived(lastMessage);\n              }\n            }\n\n            // Save to localStorage if persistenceKey is provided\n            if (persistenceKey) {\n              saveMessagesToLocalStorage();\n            }\n          },\n          onError: (err: Error) => {\n            console.error('Stream error:', err);\n            error.value = err;\n            isLoading.value = false;\n            if (onError) onError(err);\n          }\n        };\n\n        if (useProxy) {\n          // Implement proxy handling here\n          // This would typically involve making a fetch request to the proxy URL\n          // with the messages and streaming the response\n          try {\n            const response = await fetch(proxyUrl, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                messages: messagesToSend,\n                model: options.model,\n                stream: true\n              })\n            });\n\n            if (!response.ok) {\n              throw new Error(`Proxy request failed with status ${response.status}`);\n            }\n\n            if (response.body) {\n              const reader = response.body.getReader();\n              const decoder = new TextDecoder();\n\n              callbacks.onStart?.();\n\n              while (true) {\n                const { done, value } = await reader.read();\n                if (done) break;\n\n                const chunk = decoder.decode(value, { stream: true });\n                callbacks.onToken?.(chunk);\n              }\n\n              callbacks.onComplete?.(responseContent);\n            }\n          } catch (err: any) {\n            callbacks.onError?.(err);\n          }\n        } else {\n          // Use the client directly\n          await client.chatStream(messagesToSend, callbacks);\n        }\n      } else {\n        // For non-streaming responses\n        let response: string;\n\n        if (useProxy) {\n          // Use proxy for non-streaming requests\n          try {\n            const proxyResponse = await fetch(proxyUrl, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                messages: messagesToSend,\n                model: options.model,\n                stream: false\n              })\n            });\n\n            if (!proxyResponse.ok) {\n              throw new Error(`Proxy request failed with status ${proxyResponse.status}`);\n            }\n\n            const data = await proxyResponse.json();\n            response = data.content || data.message || data.response || '';\n          } catch (err: any) {\n            throw new Error(`Proxy request failed: ${err.message}`);\n          }\n        } else {\n          // Use the client directly\n          response = await client.chat(messagesToSend);\n        }\n\n        // Add assistant message\n        const assistantMessage: Message = {\n          role: 'assistant',\n          content: response,\n          id: uuidv4(),\n          timestamp: new Date()\n        };\n        messages.value.push(assistantMessage);\n\n        // Call onResponseReceived callback if provided\n        if (onResponseReceived) {\n          onResponseReceived(assistantMessage);\n        }\n\n        isLoading.value = false;\n      }\n\n      // Limit the number of messages\n      if (messages.value.length > maxMessages) {\n        // Keep system message and the last maxMessages messages\n        const systemMessages = messages.value.filter(msg => msg.role === 'system');\n        const recentMessages = messages.value.slice(-maxMessages);\n        messages.value = [...systemMessages, ...recentMessages];\n      }\n    } catch (err: any) {\n      error.value = new Error(`Failed to send message: ${err.message}`);\n      isLoading.value = false;\n      if (onError) onError(error.value);\n    }\n  };\n\n  /**\n   * Clear all messages\n   */\n  const clearMessages = (): void => {\n    messages.value = [];\n    error.value = null;\n  };\n\n  /**\n   * Set messages array\n   *\n   * @param newMessages - New messages array\n   */\n  const setMessages = (newMessages: Message[]): void => {\n    messages.value = initializeMessages(newMessages);\n  };\n\n  /**\n   * Add a single message\n   *\n   * @param message - Message to add\n   */\n  const addMessage = (message: Message): void => {\n    messages.value.push({\n      ...message,\n      id: message.id || uuidv4(),\n      timestamp: message.timestamp || new Date()\n    });\n  };\n\n  return {\n    messages,\n    isLoading,\n    error,\n    sendMessage,\n    clearMessages,\n    setMessages,\n    addMessage,\n    resetError,\n    updateConfig\n  };\n}\n\n/**\n * Helper function to get default model for a provider\n */\nfunction getDefaultModelForProvider(provider: AIProvider): string {\n  switch (provider) {\n    case 'openai':\n      return 'gpt-3.5-turbo';\n    case 'claude':\n      return 'claude-3-sonnet-20240229';\n    case 'gemini':\n      return 'gemini-pro';\n    case 'huggingface':\n      return 'mistralai/Mistral-7B-Instruct-v0.2';\n    case 'ollama':\n      return 'llama2';\n    case 'deepseek':\n      return 'deepseek-chat';\n    default:\n      return 'gpt-3.5-turbo';\n  }\n}\n\nexport default useChatEngine;\n","import MarkdownIt from 'markdown-it';\n\n// Initialize markdown-it with options\nconst md = new MarkdownIt({\n  html: false,        // Disable HTML tags in source\n  xhtmlOut: false,    // Use '/' to close single tags (<br />)\n  breaks: true,       // Convert '\\n' in paragraphs into <br>\n  linkify: true,      // Autoconvert URL-like text to links\n  typographer: true,  // Enable smartquotes and other typographic replacements\n  highlight: function (str: string, lang: string) {\n    // You could add syntax highlighting here if needed\n    return `<pre class=\"language-${lang}\"><code>${str}</code></pre>`;\n  }\n});\n\n/**\n * Format markdown text to HTML\n * \n * @param text - Markdown text to format\n * @returns HTML formatted text\n */\nexport function formatMarkdown(text: string): string {\n  if (!text) return '';\n  return md.render(text);\n}\n\nexport default {\n  formatMarkdown\n};\n","<template>\n  <div class=\"ai-chat-window\" :class=\"{ 'ai-chat-window--dark': theme === 'dark' }\">\n    <div class=\"ai-chat-window__header\">\n      <slot name=\"header\">\n        <h3 class=\"ai-chat-window__title\">{{ title }}</h3>\n      </slot>\n    </div>\n\n    <div class=\"ai-chat-window__messages\" ref=\"messagesContainer\">\n      <template v-for=\"(message, index) in messages\" :key=\"message.id || index\">\n        <slot\n          v-if=\"message.role === 'user'\"\n          name=\"user-message\"\n          :message=\"message\"\n          :index=\"index\"\n        >\n          <div class=\"ai-chat-window__message ai-chat-window__message--user\">\n            <div v-if=\"showAvatars\" class=\"ai-chat-window__avatar ai-chat-window__avatar--user\">\n              <img v-if=\"userAvatar\" :src=\"userAvatar\" alt=\"User\" />\n              <div v-else class=\"ai-chat-window__avatar-placeholder\">U</div>\n            </div>\n            <div class=\"ai-chat-window__message-content\">\n              <div class=\"ai-chat-window__message-text\">{{ message.content }}</div>\n              <div v-if=\"showTimestamps && message.timestamp\" class=\"ai-chat-window__message-timestamp\">\n                {{ formatTimestamp(message.timestamp) }}\n              </div>\n            </div>\n          </div>\n        </slot>\n\n        <slot\n          v-else-if=\"message.role === 'assistant'\"\n          name=\"assistant-message\"\n          :message=\"message\"\n          :index=\"index\"\n        >\n          <div class=\"ai-chat-window__message ai-chat-window__message--assistant\">\n            <div v-if=\"showAvatars\" class=\"ai-chat-window__avatar ai-chat-window__avatar--assistant\">\n              <img v-if=\"assistantAvatar\" :src=\"assistantAvatar\" alt=\"Assistant\" />\n              <div v-else class=\"ai-chat-window__avatar-placeholder\">A</div>\n            </div>\n            <div class=\"ai-chat-window__message-content\">\n              <div class=\"ai-chat-window__message-text\" v-html=\"formatMessage(message.content)\"></div>\n              <div v-if=\"showTimestamps && message.timestamp\" class=\"ai-chat-window__message-timestamp\">\n                {{ formatTimestamp(message.timestamp) }}\n              </div>\n              <button\n                v-if=\"showCopyButton\"\n                class=\"ai-chat-window__copy-button\"\n                @click=\"copyToClipboard(message.content)\"\n              >\n                Copy\n              </button>\n            </div>\n          </div>\n        </slot>\n\n        <slot\n          v-else\n          name=\"message\"\n          :message=\"message\"\n          :index=\"index\"\n        >\n          <div class=\"ai-chat-window__message\">\n            <div class=\"ai-chat-window__message-role\">{{ message.role }}</div>\n            <div class=\"ai-chat-window__message-content\">\n              <div class=\"ai-chat-window__message-text\">{{ message.content }}</div>\n            </div>\n          </div>\n        </slot>\n      </template>\n\n      <div v-if=\"isLoading\" class=\"ai-chat-window__loading\">\n        <slot name=\"loading\">\n          <div class=\"ai-chat-window__loading-text\">{{ loadingText }}</div>\n        </slot>\n      </div>\n\n      <div v-if=\"error\" class=\"ai-chat-window__error\">\n        <slot name=\"error\" :error=\"error\">\n          <div class=\"ai-chat-window__error-text\">{{ errorText }}</div>\n        </slot>\n      </div>\n    </div>\n\n    <div class=\"ai-chat-window__input-container\">\n      <slot name=\"input\" :input=\"userInput\" :send-message=\"handleSendMessage\">\n        <div class=\"ai-chat-window__input-wrapper\">\n          <textarea\n            v-model=\"userInput\"\n            class=\"ai-chat-window__input\"\n            :placeholder=\"placeholder\"\n            :disabled=\"isLoading\"\n            @keydown.enter.prevent=\"handleKeyDown\"\n            ref=\"inputElement\"\n          ></textarea>\n          <button\n            class=\"ai-chat-window__send-button\"\n            @click=\"handleSendMessage\"\n            :disabled=\"isLoading || !userInput.trim()\"\n          >\n            Send\n          </button>\n        </div>\n      </slot>\n    </div>\n\n    <div class=\"ai-chat-window__footer\">\n      <slot name=\"footer\">\n        <button\n          v-if=\"messages.length > 0\"\n          class=\"ai-chat-window__clear-button\"\n          @click=\"clearMessages\"\n        >\n          Clear Chat\n        </button>\n      </slot>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, nextTick, onMounted, PropType } from 'vue';\nimport { AIClient, AIProvider } from '@aivue/core';\nimport { useChatEngine, Message } from '../composables/useChatEngine';\nimport { formatMarkdown } from '../utils/markdown';\n\n// Define props with TypeScript\nconst props = defineProps({\n  // Provider configuration (either client or provider is required)\n  client: {\n    type: Object as PropType<AIClient>,\n    default: null\n  },\n  provider: {\n    type: String as PropType<AIProvider>,\n    default: null\n  },\n  apiKey: {\n    type: String,\n    default: null\n  },\n  model: {\n    type: String,\n    default: null\n  },\n  baseUrl: {\n    type: String,\n    default: null\n  },\n  organizationId: {\n    type: String,\n    default: null\n  },\n\n  // API security options\n  useProxy: {\n    type: Boolean,\n    default: false\n  },\n  proxyUrl: {\n    type: String,\n    default: '/api/chat'\n  },\n\n  // Demo mode\n  demoMode: {\n    type: Boolean,\n    default: false\n  },\n  demoResponses: {\n    type: Object as PropType<Record<string, string>>,\n    default: () => ({\n      'hello': 'Hello! I\\'m a demo AI assistant. How can I help you today?',\n      'help': 'I can help you with various tasks. Just ask me a question!',\n      'features': 'This chatbot component supports markdown, code highlighting, streaming responses, and more!'\n    })\n  },\n\n  // Chat configuration\n  title: {\n    type: String,\n    default: 'Chat'\n  },\n  placeholder: {\n    type: String,\n    default: 'Type a message...'\n  },\n  initialMessages: {\n    type: Array as PropType<Message[]>,\n    default: () => []\n  },\n  systemPrompt: {\n    type: String,\n    default: 'You are a helpful assistant.'\n  },\n  streaming: {\n    type: Boolean,\n    default: true\n  },\n  loadingText: {\n    type: String,\n    default: 'Thinking...'\n  },\n  errorText: {\n    type: String,\n    default: 'An error occurred. Please try again.'\n  },\n\n  // UI configuration\n  showTimestamps: {\n    type: Boolean,\n    default: false\n  },\n  showCopyButton: {\n    type: Boolean,\n    default: true\n  },\n  showAvatars: {\n    type: Boolean,\n    default: true\n  },\n  userAvatar: {\n    type: String,\n    default: null\n  },\n  assistantAvatar: {\n    type: String,\n    default: null\n  },\n  theme: {\n    type: String as PropType<'light' | 'dark'>,\n    default: 'light',\n    validator: (value: string) => ['light', 'dark'].includes(value)\n  },\n  height: {\n    type: String,\n    default: '500px'\n  },\n  width: {\n    type: String,\n    default: '100%'\n  },\n  maxWidth: {\n    type: String,\n    default: '800px'\n  },\n  persistenceKey: {\n    type: String,\n    default: null\n  }\n});\n\n// Define emits\nconst emit = defineEmits(['message-sent', 'response-received', 'error']);\n\n// Local state\nconst userInput = ref('');\nconst messagesContainer = ref<HTMLElement | null>(null);\nconst inputElement = ref<HTMLTextAreaElement | null>(null);\n\n// Validate that either client or provider is provided\nif (!props.client && !props.provider) {\n  console.error('Either client or provider must be specified in AiChatWindow props');\n}\n\n// Configure chat options\nconst chatOptions = computed(() => ({\n  // Provider configuration\n  client: props.client,\n  provider: props.provider as AIProvider,\n  apiKey: props.apiKey,\n  model: props.model,\n  baseUrl: props.baseUrl,\n  organizationId: props.organizationId,\n\n  // API security\n  useProxy: props.useProxy,\n  proxyUrl: props.proxyUrl,\n\n  // Chat behavior\n  systemPrompt: props.systemPrompt,\n  initialMessages: props.initialMessages,\n  streaming: props.streaming,\n  persistenceKey: props.persistenceKey,\n  demoMode: props.demoMode,\n  demoResponses: props.demoResponses,\n\n  // Callbacks\n  onError: (error: Error) => {\n    emit('error', { error });\n  },\n  onMessageSent: (message: Message) => {\n    emit('message-sent', { message });\n  },\n  onResponseReceived: (message: Message) => {\n    emit('response-received', { message });\n  }\n}));\n\n// Initialize chat engine\nconst {\n  messages,\n  isLoading,\n  error,\n  sendMessage,\n  clearMessages\n} = useChatEngine(chatOptions.value);\n\n// Handle sending messages\nconst handleSendMessage = async () => {\n  if (!userInput.value.trim() || isLoading.value) return;\n\n  const message = userInput.value;\n  userInput.value = '';\n\n  try {\n    await sendMessage(message);\n  } catch (err) {\n    // Error is already handled by the onError callback\n  }\n};\n\n// Handle keyboard events\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (event.key === 'Enter' && !event.shiftKey) {\n    event.preventDefault();\n    handleSendMessage();\n  }\n};\n\n// Format message content with markdown\nconst formatMessage = (content: string): string => {\n  return formatMarkdown(content);\n};\n\n// Format timestamp for display\nconst formatTimestamp = (timestamp?: Date): string => {\n  if (!timestamp) return '';\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString();\n};\n\n// Copy message content to clipboard\nconst copyToClipboard = (text: string): void => {\n  navigator.clipboard.writeText(text)\n    .then(() => {\n      // Could show a toast notification here\n      console.log('Copied to clipboard');\n    })\n    .catch(err => {\n      console.error('Failed to copy text: ', err);\n    });\n};\n\n// Auto-scroll to bottom when new messages arrive\nwatch(messages, () => {\n  nextTick(() => {\n    if (messagesContainer.value) {\n      messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;\n    }\n  });\n}, { deep: true });\n\n// Focus input on mount\nonMounted(() => {\n  if (inputElement.value) {\n    inputElement.value.focus();\n  }\n});\n</script>\n\n<style>\n.ai-chat-window {\n  display: flex;\n  flex-direction: column;\n  border: 1px solid var(--aivue-chat-border, #e0e0e0);\n  border-radius: var(--aivue-chat-border-radius, 8px);\n  background-color: var(--aivue-chat-bg, #ffffff);\n  color: var(--aivue-chat-text, #333333);\n  font-family: var(--aivue-chat-font-family, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);\n  height: 500px;\n  width: 100%;\n  max-width: 800px;\n  margin: 0 auto;\n  overflow: hidden;\n}\n\n.ai-chat-window--dark {\n  --aivue-chat-bg: #1e1e1e;\n  --aivue-chat-border: #444444;\n  --aivue-chat-text: #f0f0f0;\n  --aivue-chat-user-bg: #2b5278;\n  --aivue-chat-assistant-bg: #383838;\n  --aivue-chat-input-bg: #2d2d2d;\n  --aivue-chat-input-border: #555555;\n  --aivue-chat-button-bg: #4a6da7;\n  --aivue-chat-button-text: #ffffff;\n}\n\n.ai-chat-window__header {\n  padding: 12px 16px;\n  border-bottom: 1px solid var(--aivue-chat-border, #e0e0e0);\n}\n\n.ai-chat-window__title {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.ai-chat-window__messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px;\n}\n\n.ai-chat-window__message {\n  display: flex;\n  margin-bottom: 16px;\n}\n\n.ai-chat-window__message--user {\n  justify-content: flex-end;\n}\n\n.ai-chat-window__avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  overflow: hidden;\n  margin-right: 8px;\n}\n\n.ai-chat-window__message--user .ai-chat-window__avatar {\n  margin-right: 0;\n  margin-left: 8px;\n  order: 2;\n}\n\n.ai-chat-window__avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.ai-chat-window__avatar-placeholder {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #e0e0e0;\n  color: #666666;\n  font-weight: bold;\n}\n\n.ai-chat-window__message-content {\n  max-width: 70%;\n  padding: 10px 14px;\n  border-radius: 12px;\n  position: relative;\n}\n\n.ai-chat-window__message--user .ai-chat-window__message-content {\n  background-color: var(--aivue-chat-user-bg, #e1f5fe);\n}\n\n.ai-chat-window__message--assistant .ai-chat-window__message-content {\n  background-color: var(--aivue-chat-assistant-bg, #f5f5f5);\n}\n\n.ai-chat-window__message-text {\n  word-break: break-word;\n}\n\n.ai-chat-window__message-timestamp {\n  font-size: 10px;\n  color: #999;\n  margin-top: 4px;\n  text-align: right;\n}\n\n.ai-chat-window__copy-button {\n  position: absolute;\n  right: 8px;\n  bottom: 8px;\n  background: transparent;\n  border: none;\n  color: #999;\n  font-size: 12px;\n  cursor: pointer;\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n\n.ai-chat-window__message-content:hover .ai-chat-window__copy-button {\n  opacity: 1;\n}\n\n.ai-chat-window__loading {\n  display: flex;\n  justify-content: center;\n  margin: 16px 0;\n}\n\n.ai-chat-window__loading-text {\n  color: var(--aivue-chat-loading, #9e9e9e);\n  font-style: italic;\n}\n\n.ai-chat-window__error {\n  color: var(--aivue-chat-error, #f44336);\n  margin: 16px 0;\n  text-align: center;\n}\n\n.ai-chat-window__input-container {\n  padding: 12px 16px;\n  border-top: 1px solid var(--aivue-chat-border, #e0e0e0);\n}\n\n.ai-chat-window__input-wrapper {\n  display: flex;\n  position: relative;\n}\n\n.ai-chat-window__input {\n  flex: 1;\n  padding: 10px 14px;\n  border: 1px solid var(--aivue-chat-input-border, #e0e0e0);\n  border-radius: 20px;\n  resize: none;\n  min-height: 40px;\n  max-height: 120px;\n  background-color: var(--aivue-chat-input-bg, #ffffff);\n  color: var(--aivue-chat-text, #333333);\n  font-family: inherit;\n  font-size: 14px;\n}\n\n.ai-chat-window__input:focus {\n  outline: none;\n  border-color: var(--aivue-chat-button-bg, #2196f3);\n}\n\n.ai-chat-window__send-button {\n  position: absolute;\n  right: 8px;\n  bottom: 8px;\n  background-color: var(--aivue-chat-button-bg, #2196f3);\n  color: var(--aivue-chat-button-text, #ffffff);\n  border: none;\n  border-radius: 50%;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n}\n\n.ai-chat-window__send-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.ai-chat-window__footer {\n  padding: 8px 16px;\n  display: flex;\n  justify-content: center;\n}\n\n.ai-chat-window__clear-button {\n  background: transparent;\n  border: none;\n  color: #999;\n  cursor: pointer;\n  font-size: 12px;\n  text-decoration: underline;\n}\n</style>\n","<template>\n  <div class=\"ai-chat-toggle\" :class=\"{ 'ai-chat-toggle--open': isOpen, 'ai-chat-toggle--bottom': position === 'bottom', 'ai-chat-toggle--top': position === 'top' }\">\n    <!-- Toggle Button -->\n    <button\n      class=\"ai-chat-toggle__button\"\n      @click=\"toggleChat\"\n      :aria-label=\"isOpen ? 'Close chat' : 'Open chat'\"\n      :title=\"isOpen ? 'Close chat' : 'Open chat'\"\n    >\n      <span v-if=\"!isOpen\" class=\"ai-chat-toggle__icon ai-chat-toggle__icon--open\">\n        <slot name=\"toggle-icon\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n          </svg>\n        </slot>\n      </span>\n      <span v-else class=\"ai-chat-toggle__icon ai-chat-toggle__icon--close\">\n        <slot name=\"close-icon\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n          </svg>\n        </slot>\n      </span>\n    </button>\n\n    <!-- Chat Window Container -->\n    <div v-show=\"isOpen\" class=\"ai-chat-toggle__window\">\n      <div class=\"ai-chat-toggle__header\" v-if=\"title\">\n        <h3 class=\"ai-chat-toggle__title\">{{ title }}</h3>\n        <button\n          class=\"ai-chat-toggle__close\"\n          @click=\"toggleChat\"\n          aria-label=\"Close chat\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n          </svg>\n        </button>\n      </div>\n\n      <!-- Actual Chat Window Component -->\n      <div class=\"ai-chat-toggle__content\">\n        <AiChatWindow\n          v-if=\"useDefaultChat\"\n          v-bind=\"chatProps\"\n          @message-sent=\"$emit('message-sent', $event)\"\n          @response-received=\"$emit('response-received', $event)\"\n          @error=\"$emit('error', $event)\"\n        />\n        <slot v-else></slot>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, computed, PropType, watch } from 'vue';\nimport { AIClient, AIProvider } from '@aivue/core';\nimport AiChatWindow from './AiChatWindow.vue';\nimport { Message } from '../composables/useChatEngine';\n\nexport default defineComponent({\n  name: 'AiChatToggle',\n  components: {\n    AiChatWindow\n  },\n  props: {\n    // Toggle behavior\n    position: {\n      type: String as PropType<'bottom' | 'top'>,\n      default: 'bottom',\n      validator: (value: string) => ['bottom', 'top'].includes(value)\n    },\n    defaultOpen: {\n      type: Boolean,\n      default: false\n    },\n    title: {\n      type: String,\n      default: 'Chat with AI'\n    },\n\n    // Provider configuration (either client or provider is required)\n    client: {\n      type: Object as PropType<AIClient>,\n      default: null\n    },\n    provider: {\n      type: String as PropType<AIProvider>,\n      default: null\n    },\n    apiKey: {\n      type: String,\n      default: null\n    },\n    model: {\n      type: String,\n      default: null\n    },\n\n    // Pass all AiChatWindow props\n    placeholder: {\n      type: String,\n      default: 'Type a message...'\n    },\n    initialMessages: {\n      type: Array as PropType<Message[]>,\n      default: () => []\n    },\n    systemPrompt: {\n      type: String,\n      default: 'You are a helpful assistant.'\n    },\n    streaming: {\n      type: Boolean,\n      default: true\n    },\n    theme: {\n      type: String as PropType<'light' | 'dark'>,\n      default: 'light'\n    },\n    showAvatars: {\n      type: Boolean,\n      default: true\n    },\n    persistenceKey: {\n      type: String,\n      default: null\n    },\n\n    // Demo mode\n    demoMode: {\n      type: Boolean,\n      default: false\n    },\n    demoResponses: {\n      type: Object as PropType<Record<string, string>>,\n      default: () => ({\n        'hello': 'Hello! I\\'m a demo AI assistant. How can I help you today?',\n        'help': 'I can help you with various tasks. Just ask me a question!',\n        'features': 'This chatbot component supports markdown, code highlighting, streaming responses, and more!'\n      })\n    }\n  },\n  emits: ['toggle', 'message-sent', 'response-received', 'error'],\n  setup(props, { emit, slots }) {\n    const isOpen = ref(props.defaultOpen);\n\n    // Check if we should use the default chat window or a custom one via slot\n    const useDefaultChat = computed(() => !slots.default);\n\n    // Prepare props to pass to AiChatWindow\n    const chatProps = computed(() => {\n      const result: Record<string, any> = {\n        placeholder: props.placeholder,\n        initialMessages: props.initialMessages,\n        systemPrompt: props.systemPrompt,\n        streaming: props.streaming,\n        theme: props.theme,\n        showAvatars: props.showAvatars,\n        persistenceKey: props.persistenceKey,\n        demoMode: props.demoMode,\n        demoResponses: props.demoResponses\n      };\n\n      // Add provider configuration\n      if (props.client) {\n        result.client = props.client;\n      } else if (props.provider) {\n        result.provider = props.provider;\n        if (props.apiKey) result.apiKey = props.apiKey;\n        if (props.model) result.model = props.model;\n      }\n\n      return result;\n    });\n\n    // Toggle chat window\n    const toggleChat = () => {\n      isOpen.value = !isOpen.value;\n      emit('toggle', isOpen.value);\n    };\n\n    // Watch for changes to defaultOpen prop\n    watch(() => props.defaultOpen, (newValue) => {\n      isOpen.value = newValue;\n    });\n\n    return {\n      isOpen,\n      toggleChat,\n      useDefaultChat,\n      chatProps\n    };\n  }\n});\n</script>\n\n<style>\n.ai-chat-toggle {\n  position: fixed;\n  z-index: 9999;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n}\n\n.ai-chat-toggle--bottom {\n  right: 20px;\n  bottom: 20px;\n}\n\n.ai-chat-toggle--top {\n  right: 20px;\n  top: 20px;\n}\n\n.ai-chat-toggle__button {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  background-color: #2563eb;\n  color: white;\n  border: none;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.3s ease, background-color 0.3s ease;\n}\n\n.ai-chat-toggle__button:hover {\n  transform: scale(1.05);\n  background-color: #1d4ed8;\n}\n\n.ai-chat-toggle__icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.ai-chat-toggle__window {\n  position: absolute;\n  bottom: 80px;\n  right: 0;\n  width: 350px;\n  height: 500px;\n  background-color: white;\n  border-radius: 12px;\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n.ai-chat-toggle--top .ai-chat-toggle__window {\n  bottom: auto;\n  top: 80px;\n}\n\n.ai-chat-toggle__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  background-color: #f8fafc;\n  border-bottom: 1px solid #e2e8f0;\n}\n\n.ai-chat-toggle__title {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: #1e293b;\n}\n\n.ai-chat-toggle__close {\n  background: none;\n  border: none;\n  cursor: pointer;\n  color: #64748b;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 4px;\n  border-radius: 4px;\n}\n\n.ai-chat-toggle__close:hover {\n  background-color: #e2e8f0;\n}\n\n.ai-chat-toggle__content {\n  flex: 1;\n  overflow: hidden;\n}\n\n/* Dark theme */\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__button {\n  background-color: #3b82f6;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__button:hover {\n  background-color: #2563eb;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__window {\n  background-color: #1e293b;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__header {\n  background-color: #0f172a;\n  border-bottom-color: #334155;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__title {\n  color: #f8fafc;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__close {\n  color: #94a3b8;\n}\n\n.ai-chat-toggle[data-theme=\"dark\"] .ai-chat-toggle__close:hover {\n  background-color: #334155;\n}\n</style>\n","// AI-powered chat components for Vue.js\nimport { App } from 'vue';\nimport { AIClient } from '@aivue/core';\nimport AiChatWindowComponent from './components/AiChatWindow.vue';\nimport AiChatToggleComponent from './components/AiChatToggle.vue';\nimport { useChatEngine as useChatEngineComposable, Message, ChatOptions, ChatState } from './composables/useChatEngine';\nimport { formatMarkdown } from './utils/markdown';\n\n// Import Vue compatibility utilities from core\nconst {\n  createCompatComponent,\n  registerCompatComponent,\n  createCompatPlugin\n} = require('@aivue/core');\n\n// Re-export types\nexport type { Message, ChatOptions, ChatState };\n\n// Export components with compatibility layer\nexport const AiChatWindow = createCompatComponent(AiChatWindowComponent);\nexport const AiChatToggle = createCompatComponent(AiChatToggleComponent);\n\n// Export composables\nexport const useChatEngine = useChatEngineComposable;\n\n// Export utilities\nexport const utils = {\n  formatMarkdown\n};\n\n// Vue Plugin with compatibility layer\nexport const AiChatPlugin = createCompatPlugin({\n  install(app: App) {\n    // Register components globally using the compatibility helper\n    registerCompatComponent(app, 'AiChatWindow', AiChatWindowComponent);\n    registerCompatComponent(app, 'AiChatToggle', AiChatToggleComponent);\n  }\n});\n\n// No need to re-export Vue compatibility utilities\n\n// Default export\nexport default {\n  AiChatWindow,\n  AiChatToggle,\n  useChatEngine,\n  utils,\n  AiChatPlugin\n};\n"],"names":["useChatEngine","options","client","AIClient","getDefaultModelForProvider","initialMessages","systemPrompt","streaming","persistenceKey","maxMessages","demoMode","demoResponses","useProxy","proxyUrl","onError","onMessageSent","onResponseReceived","messages","ref","isLoading","error","initializeMessages","msgs","msg","uuidv4","onMounted","savedMessages","err","saveMessagesToLocalStorage","watch","content","userMessage","messagesToSend","role","demoResponse","userMessageLower","key","response","assistantMessage","streamedContent","char","resolve","responseContent","callbacks","token","lastMessage","completeText","reader","decoder","_a","done","value","chunk","_b","_c","_d","proxyResponse","data","systemMessages","recentMessages","newMessages","message","config","provider","md","MarkdownIt","str","lang","formatMarkdown","text","props","__props","emit","__emit","userInput","messagesContainer","inputElement","chatOptions","computed","sendMessage","clearMessages","handleSendMessage","handleKeyDown","event","formatMessage","formatTimestamp","timestamp","copyToClipboard","nextTick","_sfc_main","defineComponent","AiChatWindow","slots","isOpen","useDefaultChat","chatProps","result","toggleChat","newValue","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_resolveComponent","_normalizeClass","_ctx","_createElementVNode","_cache","args","_renderSlot","_openBlock","_createElementBlock","title","_withDirectives","_hoisted_6","_toDisplayString","_hoisted_7","_createBlock","_component_AiChatWindow","$emit","$event","createCompatComponent","registerCompatComponent","createCompatPlugin","AiChatWindowComponent","AiChatToggle","AiChatToggleComponent","useChatEngineComposable","utils","AiChatPlugin","app","index"],"mappings":"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"}